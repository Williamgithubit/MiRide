import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { updateSecuritySettings, revokeAllSessions } from '../../../../../store/Admin/adminSettingsSlice';
import { FaLock, FaMobile, FaHistory, FaDesktop, FaMapMarkerAlt, FaClock, FaTrash, FaExclamationTriangle } from 'react-icons/fa';
const ConfirmationModal = ({ isOpen, onClose, onConfirm, title, message, confirmText, isDestructive = false, }) => {
    if (!isOpen)
        return null;
    return (_jsx("div", { className: "fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4", children: _jsxs("div", { className: "bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6", children: [_jsxs("div", { className: "flex items-center gap-3 mb-4", children: [_jsx(FaExclamationTriangle, { className: `w-6 h-6 ${isDestructive ? 'text-red-600' : 'text-yellow-600'}` }), _jsx("h3", { className: "text-lg font-semibold text-gray-900 dark:text-white", children: title })] }), _jsx("p", { className: "text-gray-600 dark:text-gray-400 mb-6", children: message }), _jsxs("div", { className: "flex gap-3 justify-end", children: [_jsx("button", { onClick: onClose, className: "px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 transition-colors", children: "Cancel" }), _jsx("button", { onClick: onConfirm, className: `px-4 py-2 text-sm font-medium text-white rounded-lg transition-colors ${isDestructive
                                ? 'bg-red-600 hover:bg-red-700'
                                : 'bg-blue-600 hover:bg-blue-700'}`, children: confirmText })] })] }) }));
};
const SecuritySettingsComponent = ({ settings }) => {
    const dispatch = useDispatch();
    const { isSaving } = useSelector((state) => state.adminSettings);
    const [twoFactorEnabled, setTwoFactorEnabled] = useState(settings?.twoFactorEnabled ?? false);
    const [showRevokeModal, setShowRevokeModal] = useState(false);
    const handleToggle2FA = async () => {
        try {
            const newValue = !twoFactorEnabled;
            await dispatch(updateSecuritySettings({ twoFactorEnabled: newValue })).unwrap();
            setTwoFactorEnabled(newValue);
        }
        catch (error) {
            console.error('Failed to update 2FA setting:', error);
        }
    };
    const handleRevokeAllSessions = async () => {
        try {
            await dispatch(revokeAllSessions()).unwrap();
            setShowRevokeModal(false);
        }
        catch (error) {
            console.error('Failed to revoke sessions:', error);
        }
    };
    const formatDate = (dateString) => {
        return new Date(dateString).toLocaleString();
    };
    const getDeviceIcon = (device) => {
        if (device.toLowerCase().includes('mobile') || device.toLowerCase().includes('android') || device.toLowerCase().includes('iphone')) {
            return _jsx(FaMobile, { className: "w-4 h-4 text-blue-600" });
        }
        return _jsx(FaDesktop, { className: "w-4 h-4 text-green-600" });
    };
    return (_jsxs("div", { className: "space-y-8", children: [_jsxs("div", { children: [_jsx("h3", { className: "text-lg font-semibold text-gray-900 dark:text-white", children: "Security Settings" }), _jsx("p", { className: "text-sm text-gray-600 dark:text-gray-400 mt-1", children: "Manage your account security and monitor access" })] }), _jsxs("div", { className: "bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6 border border-gray-200 dark:border-gray-600 hover:shadow-md transition-shadow", children: [_jsxs("h4", { className: "text-md font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2", children: [_jsx(FaLock, { className: "text-green-600" }), "Two-Factor Authentication"] }), _jsxs("div", { className: "flex items-center justify-between p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600", children: [_jsxs("div", { children: [_jsx("h5", { className: "font-medium text-gray-900 dark:text-white", children: "Enable 2FA Protection" }), _jsx("p", { className: "text-sm text-gray-600 dark:text-gray-400", children: "Add an extra layer of security to your account with two-factor authentication" })] }), _jsx("button", { onClick: handleToggle2FA, disabled: isSaving, className: `relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${twoFactorEnabled
                                    ? 'bg-green-600'
                                    : 'bg-gray-200 dark:bg-gray-600'} ${isSaving ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}`, children: _jsx("span", { className: `inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${twoFactorEnabled ? 'translate-x-6' : 'translate-x-1'}` }) })] }), twoFactorEnabled && (_jsxs("div", { className: "mt-4 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg", children: [_jsxs("div", { className: "flex items-center gap-2 text-green-800 dark:text-green-400 mb-2", children: [_jsx(FaLock, { className: "w-4 h-4" }), _jsx("span", { className: "font-medium", children: "2FA is Active" })] }), _jsx("p", { className: "text-sm text-green-700 dark:text-green-300", children: "Your account is protected with two-factor authentication. You'll need to enter a verification code when signing in." })] }))] }), _jsxs("div", { className: "bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6 border border-gray-200 dark:border-gray-600 hover:shadow-md transition-shadow", children: [_jsxs("h4", { className: "text-md font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2", children: [_jsx(FaHistory, { className: "text-blue-600" }), "Recent Login History"] }), _jsx("div", { className: "space-y-3", children: settings?.lastLoginHistory && settings.lastLoginHistory.length > 0 ? (settings.lastLoginHistory.slice(0, 5).map((login) => (_jsxs("div", { className: "flex items-center justify-between p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600", children: [_jsxs("div", { className: "flex items-center gap-4", children: [getDeviceIcon(login.device), _jsxs("div", { children: [_jsx("div", { className: "flex items-center gap-2", children: _jsx("span", { className: "font-medium text-gray-900 dark:text-white", children: login.device }) }), _jsxs("div", { className: "flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400", children: [_jsxs("span", { className: "flex items-center gap-1", children: [_jsx(FaMapMarkerAlt, { className: "w-3 h-3" }), login.location] }), _jsxs("span", { children: ["IP: ", login.ipAddress] })] })] })] }), _jsx("div", { className: "text-right", children: _jsxs("div", { className: "flex items-center gap-1 text-sm text-gray-600 dark:text-gray-400", children: [_jsx(FaClock, { className: "w-3 h-3" }), formatDate(login.timestamp)] }) })] }, login.id)))) : (_jsxs("div", { className: "text-center py-8 text-gray-500 dark:text-gray-400", children: [_jsx(FaHistory, { className: "w-8 h-8 mx-auto mb-2 opacity-50" }), _jsx("p", { children: "No login history available" })] })) })] }), _jsxs("div", { className: "bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6 border border-gray-200 dark:border-gray-600 hover:shadow-md transition-shadow", children: [_jsxs("div", { className: "flex items-center justify-between mb-4", children: [_jsxs("h4", { className: "text-md font-semibold text-gray-900 dark:text-white flex items-center gap-2", children: [_jsx(FaDesktop, { className: "text-purple-600" }), "Active Sessions"] }), _jsxs("button", { onClick: () => setShowRevokeModal(true), disabled: isSaving || !settings?.activeSessions?.length, className: "px-4 py-2 text-sm font-medium bg-red-600 hover:bg-red-700 disabled:bg-red-400 text-white rounded-lg transition-colors flex items-center gap-2", children: [_jsx(FaTrash, { className: "w-3 h-3" }), "Revoke All Sessions"] })] }), _jsx("div", { className: "space-y-3", children: settings?.activeSessions && settings.activeSessions.length > 0 ? (settings.activeSessions.map((session) => (_jsxs("div", { className: `flex items-center justify-between p-4 rounded-lg border ${session.isCurrent
                                ? 'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800'
                                : 'bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-600'}`, children: [_jsxs("div", { className: "flex items-center gap-4", children: [getDeviceIcon(session.device), _jsxs("div", { children: [_jsxs("div", { className: "flex items-center gap-2", children: [_jsx("span", { className: "font-medium text-gray-900 dark:text-white", children: session.device }), session.isCurrent && (_jsx("span", { className: "px-2 py-1 text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full", children: "Current Session" }))] }), _jsxs("div", { className: "flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400", children: [_jsxs("span", { children: ["IP: ", session.ipAddress] }), _jsxs("span", { className: "flex items-center gap-1", children: [_jsx(FaClock, { className: "w-3 h-3" }), "Last active: ", formatDate(session.lastActive)] })] })] })] }), !session.isCurrent && (_jsx("button", { className: "text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors", title: "Revoke this session", children: _jsx(FaTrash, { className: "w-4 h-4" }) }))] }, session.id)))) : (_jsxs("div", { className: "text-center py-8 text-gray-500 dark:text-gray-400", children: [_jsx(FaDesktop, { className: "w-8 h-8 mx-auto mb-2 opacity-50" }), _jsx("p", { children: "No active sessions found" })] })) })] }), _jsxs("div", { className: "bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-6 border border-yellow-200 dark:border-yellow-800", children: [_jsxs("h4", { className: "text-md font-semibold text-yellow-800 dark:text-yellow-200 mb-4 flex items-center gap-2", children: [_jsx(FaLock, { className: "text-yellow-600" }), "Security Recommendations"] }), _jsxs("ul", { className: "space-y-2 text-sm text-yellow-700 dark:text-yellow-300", children: [_jsxs("li", { className: "flex items-start gap-2", children: [_jsx("span", { className: "w-1.5 h-1.5 bg-yellow-600 rounded-full mt-2 flex-shrink-0" }), "Enable two-factor authentication for enhanced security"] }), _jsxs("li", { className: "flex items-start gap-2", children: [_jsx("span", { className: "w-1.5 h-1.5 bg-yellow-600 rounded-full mt-2 flex-shrink-0" }), "Regularly review your login history and active sessions"] }), _jsxs("li", { className: "flex items-start gap-2", children: [_jsx("span", { className: "w-1.5 h-1.5 bg-yellow-600 rounded-full mt-2 flex-shrink-0" }), "Use a strong, unique password for your admin account"] }), _jsxs("li", { className: "flex items-start gap-2", children: [_jsx("span", { className: "w-1.5 h-1.5 bg-yellow-600 rounded-full mt-2 flex-shrink-0" }), "Revoke sessions from devices you no longer use"] })] })] }), _jsx(ConfirmationModal, { isOpen: showRevokeModal, onClose: () => setShowRevokeModal(false), onConfirm: handleRevokeAllSessions, title: "Revoke All Sessions", message: "This will sign you out of all devices except the current one. You'll need to sign in again on other devices. Are you sure you want to continue?", confirmText: "Revoke All Sessions", isDestructive: true })] }));
};
export default SecuritySettingsComponent;
